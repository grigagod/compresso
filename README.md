# Compresso
This service is designed for storing and processing (downsampling, compressing and converting) video. It provides a RESTful API that allows users to upload videos, make requests to process them, download original and processed videos. CLI client can be found there.

## Project structure
Enspired by the Uncle's Bob Clean Architechture.

```
├── build/
├── cmd/ -- store entrypoints for the services
├── docker/ -- store Dockerfiles
├── docs/ -- store generated by swaggo OpenAPI documentation
├── internal/ -- main business logic
│   ├── auth/ -- Has mostly the same structure as video/
│   ├── httper/ -- http error handling, parsing and messages definitions
│   ├── httpserver/ -- skeleton for the http server
│   ├── middleware/
│   ├── models/ -- models (entities) definitions
│   ├── storage/ -- represents storage layer and AWS implementation.
│   ├── utils/
│   └── video/ -- stores codebase for videoapi and videosvc
│       ├── config/ -- configuration using env variables
│       ├── convsvc/ -- extra pkg for videosvc
│       ├── delivery.go -- delivery layer definiton
│       ├── delivery/ -- its implementation
│       │   └── http/
│       ├── repo.go -- video repository definition
│       ├── repo/ -- it`s implementation
│       ├── server/
│       ├── usecase/ -- 
│       └── usecase.go -- video service usecases definitions 
├── migrations/ -- database migrations
├── pkg/ -- 
│   ├── converter/ -- media converting pkg, uses ffmpeg calls for audio and video processing
│   ├── db/
│   │   ├── aws/ -- pkg for new AWS sessions
│   │   └── postgres/ -- pkg new for Postgres connections 
│   ├── logger/ -- logger interface and implementation
│   └── rmq/ -- pkg for interacting with RabbitMQ
```

## Local usage
Checkout ```Makefile``` for more information and usecases.
### Binary services:

```
source .env.local // configure (export environment vars)
make local.up // run local enviroment(Postgresql, RabbitMQ)
make SERVICE.run // run = clean + build + execute binary of SERVICE, availible options for SERVICE: auth, videoapi, videosvc
```

### Containerized services:
Services configuration must be placed in ```.env.dev``` in the project's root directory.
```
make dev.up // run local enviroment(Postgresql, RabbitMQ) and all services
make dev.down 
```

### Testing and linting:
```
make test // run all tests, some tests require environment
make lint // lint code, golangci-lint should be installed
```

## APIs documentation
Endpoints for default configuration and local binary usage.
### Auth service
http://localhost:5000/swagger/
### Video service
http://localhost:5001/swagger/


